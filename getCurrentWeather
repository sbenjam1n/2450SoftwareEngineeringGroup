//Steven Benjamin - 2450 Team Project - Weather Get


//todo - get zip code or openweather city id from a user inputted location.


var country="us";

var zip;

//number of dayts to forecast, 16 is the max
var forecastLength = 2;

//Set usersChoice to true if user has supplied a city that can be associated with a zip code.
var usersChoice;



$(document).ready(function getPosition() 
{

  //Get weather details based on approximate location if the user doesn't have a preference.
  if(usersChoice!==true)
  {
    
  // Find the longitude and latitude based on the users ip.
  var location = "http://ip-api.com/json";

  $.getJSON(location, function(json) 
  {

    lat = json.lat;
    lon = json.lon;

    //Get the weather data from the open weather API
    $.getJSON("http://api.openweathermap.org/data/2.5/weather?lat=" + lat + "&lon=" + lon + "&APPID=ccd8e53c44061ba9fa3596d8aa75cc5e", function(json) 
    {
    //console.log(json);
      var country = json.sys.country;
      var city = json.name;
      var location = city + ", " + country;

      //Let's see if that worked...
      console.log(city);
      console.log(country);

      //how to get the weather description
      var weather = json.weather[0].description;
      console.log(weather);

      //using the temprature converter
      var temp = json.main.temp;
      var getTemp = new convertTemp(temp);
      console.log(getTemp.celcius());
      console.log(getTemp.frnht());
     
      //the forecast
              $.getJSON('http://api.openweathermap.org/data/2.5/forecast/daily?q='+ city +','+ country + '&cnt=' + forecastLength + '&APPID=ccd8e53c44061ba9fa3596d8aa75cc5e',function(json)
              {
               
                //console.log(json);  
                

                
                //how to get a date item from the retrieved forecast list...
                var currentForecast = json.list[1].dt;
                var date = new convertDate(currentForecast);
                console.log(date.date());

                var temp = json.list[1].temp.day;
                //console.log(temp);
    
    
              });

    });
  });
  } //end if 
  

  //If we have a zip code...
  else
  {

    $.getJSON("http://api.openweathermap.org/data/2.5/weather?zip="+ zip +"," + country + "&APPID=ccd8e53c44061ba9fa3596d8aa75cc5e",function(json)
    {

      var country = json.sys.country;
      var city = json.name;
      var location = city + ", " + country;

      //Let's see if that worked...
      console.log(city);
      console.log(country);


      var weather = json.weather[0].description;

      var temp = json.main.temp;
      
      //using the temprature converter
      var getTemp = new convertTemp(temp);
      console.log(getTemp.celcius());
      console.log(getTemp.frnht());
     
      console.log(getTemp.celcius());
      console.log(getTemp.frnht());
        
      
      $.getJSON('http://api.openweathermap.org/data/2.5/forecast/daily?q='+ city +','+ country + '&cnt=' + forecastLength + '&APPID=ccd8e53c44061ba9fa3596d8aa75cc5e',function(json)
       {
        //console.log(json);    
    
    
       });
    });
   }//end else
  
  
  //converts a unix time stamp to a usable date
  function convertDate(unixDate)
  {
      var a = new Date(unixDate * 1000);
      var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      
      return{
      year: function(){ return a.getFullYear();},
      month: function(){ return months[a.getMonth()];},
      date: function(){ return a.getDate();},
      hour: function(){ return a.getHours();},
      min: function(){ return a.getMinutes();},
      sec: function(){ return a.getSeconds();}
      };
  }
  
  //converts kelvin to celcius of fahrenheit
  function convertTemp(temp)
  {
      var c = Math.round((temp - 273.15));
      
      return{
      celcius : function(){return c;},
      frnht : function(){return Math.round(c * 1.8 + 32);}
      };
    
  }
  
});

